// Generated by Haxe 4.3.2
(function ($global) { "use strict";
var StructuredJQuery = {};
StructuredJQuery.setFields = function(this1,fields) {
	this1.data("structuredFields",fields);
};
StructuredJQuery.getFields = function(this1) {
	return this1.data("structuredFields");
};
var Form = {};
Form.initRenderers = function() {
	Form.renderers = [{ type : "text", renderer : function(form,item) {
		var input = $("<input class=\"ludi-form ludi-form-text\" type=\"text\">");
		input.on("input",null,function() {
			Form.handleChange(form,item.label);
		});
		return $("<div class=\"ludi-form ludi-form-control-container\">").append(item.label).append(input);
	}, getValue : function(_,_1,control) {
		return control.find("input").val();
	}, setValue : function(_,_1,control,value) {
		control.find("input").val(value);
	}},{ type : "checkbox", renderer : function(form,item) {
		var input = $("<input class=\"ludi-form ludi-form-checkbox\" type=\"checkbox\">");
		input.on("change",null,function() {
			Form.handleChange(form,item.label);
		});
		return $("<div class=\"ludi-form ludi-form-control-container\">").append(item.label).append(input);
	}, getValue : function(_,_1,control) {
		return control.find("input").val() == "on";
	}, setValue : function(_,_1,control,value) {
		control.find("input").val(value ? "on" : "off");
	}},{ type : "number", renderer : function(form,item) {
		var input = $("<input class=\"ludi-form ludi-form-number\" type=\"number\">");
		input.on("input",null,function() {
			Form.handleChange(form,item.label);
		});
		return $("<div class=\"ludi-form ludi-form-control-container\">").append(item.label).append(input);
	}, getValue : function(_,_1,control) {
		return parseFloat(control.find("input").val());
	}, setValue : function(_,_1,control,value) {
		control.find("input").val(value);
	}},{ type : "dropdown", renderer : function(form,item) {
		var options = Reflect.field(item,"options");
		var select = $("<select class=\"ludi-form ludi-form-select\" >");
		if(options != null && ((options) instanceof Array)) {
			var _g = 0;
			var _g1 = options;
			while(_g < _g1.length) {
				var option = _g1[_g];
				++_g;
				select.append($("<option class=\"ludi-form ludi-form-option\" >").val(option).text(option));
			}
		}
		select.on("change",null,function() {
			Form.handleChange(form,item.label);
		});
		return $("<div class=\"ludi-form ludi-form-control-container\" >").append(item.label).append(select);
	}, getValue : function(_,_1,control) {
		return control.find("select").val();
	}, setValue : function(_,_1,control,value) {
		control.find("select").val(value);
	}},{ type : "button", renderer : function(form,item) {
		var button = $("<button class=\"ludi-form ludi-form-button\">").text(item.label);
		button.on("click",null,function() {
			Form.handleChange(form,item.label);
		});
		return button;
	}, getValue : function(_,_1,_2) {
		return true;
	}, setValue : function(_,_1,_2,_3) {
	}}];
};
Form._new = function(schema) {
	if(Form.renderers.length == 0) {
		Form.initRenderers();
	}
	var this1 = $("<div class=\"ludi-form ludi-form-form-container\">");
	var controls = new haxe_ds_StringMap();
	var changeCallbacks = new haxe_ds_StringMap();
	StructuredJQuery.setFields(this1,{ schema : schema, subforms : new haxe_ds_StringMap(), controls : controls, changeCallbacks : changeCallbacks});
	var _g = 0;
	while(_g < schema.length) {
		var item = schema[_g];
		++_g;
		var control = Form.renderItem(this1,item);
		controls.h[item.label] = control;
		this1.append(control);
	}
	return this1;
};
Form.renderItem = function(this1,item) {
	var _g = 0;
	var _g1 = Form.renderers;
	while(_g < _g1.length) {
		var renderer = _g1[_g];
		++_g;
		if(renderer.type == item.type) {
			return renderer.renderer(this1,item);
		}
	}
	return $("<div>").text("Unknown type: " + item.type);
};
Form.handleChange = function(this1,label) {
	var fields = StructuredJQuery.getFields(this1);
	if(Object.prototype.hasOwnProperty.call(fields.changeCallbacks.h,label)) {
		fields.changeCallbacks.h[label]();
	}
};
Form.onChange = function(this1,itemLabel,cb) {
	var fields = StructuredJQuery.getFields(this1);
	fields.changeCallbacks.h[itemLabel] = cb;
	StructuredJQuery.setFields(this1,fields);
};
Form.setSubform = function(this1,itemLabel,schema) {
	var fields = StructuredJQuery.getFields(this1);
	var subform = Form._new(schema);
	fields.subforms.h[itemLabel] = subform;
	var itemDiv = this1.find("div:contains(\"" + itemLabel + "\")");
	itemDiv.append(subform);
	StructuredJQuery.setFields(this1,fields);
};
Form.removeSubform = function(this1,itemLabel) {
	var fields = StructuredJQuery.getFields(this1);
	if(Object.prototype.hasOwnProperty.call(fields.subforms.h,itemLabel)) {
		fields.subforms.h[itemLabel].remove();
		var _this = fields.subforms;
		if(Object.prototype.hasOwnProperty.call(_this.h,itemLabel)) {
			delete(_this.h[itemLabel]);
		}
		StructuredJQuery.setFields(this1,fields);
	}
};
Form.getValues = function(this1) {
	var fields = StructuredJQuery.getFields(this1);
	var values = new haxe_ds_StringMap();
	var _g = 0;
	var _g1 = fields.schema;
	while(_g < _g1.length) {
		var item = [_g1[_g]];
		++_g;
		var control = fields.controls.h[item[0].label];
		if(control != null) {
			var renderer = Lambda.find(Form.renderers,(function(item) {
				return function(r) {
					return r.type == item[0].type;
				};
			})(item));
			if(renderer != null) {
				var value = renderer.getValue(this1,item[0],control);
				values.h[item[0].label] = { value : value};
			}
		}
	}
	var h = fields.subforms.h;
	var key_h = h;
	var key_keys = Object.keys(h);
	var key_length = key_keys.length;
	var key_current = 0;
	while(key_current < key_length) {
		var key = key_keys[key_current++];
		var subformValues = Form.getValues(fields.subforms.h[key]);
		if(Object.prototype.hasOwnProperty.call(values.h,key)) {
			var existing = values.h[key];
			values.h[key] = { value : existing.value, subform : subformValues};
		} else {
			values.h[key] = { value : null, subform : subformValues};
		}
	}
	return values;
};
var Lambda = function() { };
Lambda.__name__ = true;
Lambda.find = function(it,f) {
	var v = $getIterator(it);
	while(v.hasNext()) {
		var v1 = v.next();
		if(f(v1)) {
			return v1;
		}
	}
	return null;
};
var Main = function() { };
Main.__name__ = true;
Main.main = function() {
	var schema = [{ label : "Name", type : "text"},{ label : "Age", type : "number"},{ label : "Country", type : "dropdown", options : ["USA","UK","Canada"]},{ label : "Submit", type : "button"}];
	var otherSchema = [{ label : "Details", type : "text"}];
	var form = Form._new(schema);
	var form1 = form;
	Form.onChange(form1,"Country",function() {
		var val = Form.getValues(form1).h["Country"].value;
		if(val == "USA") {
			Form.setSubform(form1,"Country",otherSchema);
		} else {
			Form.removeSubform(form1,"Country");
		}
	});
	Form.onChange(form1,"Submit",function() {
		var tmp = Form.getValues(form1);
		console.log("src/Main.hx:27:",tmp == null ? "null" : haxe_ds_StringMap.stringify(tmp.h));
	});
	var form2 = form;
	$("body").append(form2);
};
Math.__name__ = true;
var Reflect = function() { };
Reflect.__name__ = true;
Reflect.field = function(o,field) {
	try {
		return o[field];
	} catch( _g ) {
		return null;
	}
};
var Std = function() { };
Std.__name__ = true;
Std.string = function(s) {
	return js_Boot.__string_rec(s,"");
};
var haxe_ds_StringMap = function() {
	this.h = Object.create(null);
};
haxe_ds_StringMap.__name__ = true;
haxe_ds_StringMap.stringify = function(h) {
	var s = "[";
	var first = true;
	for (var key in h) {
		if (first) first = false; else s += ',';
		s += key + ' => ' + Std.string(h[key]);
	}
	return s + "]";
};
var haxe_iterators_ArrayIterator = function(array) {
	this.current = 0;
	this.array = array;
};
haxe_iterators_ArrayIterator.__name__ = true;
haxe_iterators_ArrayIterator.prototype = {
	hasNext: function() {
		return this.current < this.array.length;
	}
	,next: function() {
		return this.array[this.current++];
	}
};
var js_Boot = function() { };
js_Boot.__name__ = true;
js_Boot.__string_rec = function(o,s) {
	if(o == null) {
		return "null";
	}
	if(s.length >= 5) {
		return "<...>";
	}
	var t = typeof(o);
	if(t == "function" && (o.__name__ || o.__ename__)) {
		t = "object";
	}
	switch(t) {
	case "function":
		return "<function>";
	case "object":
		if(((o) instanceof Array)) {
			var str = "[";
			s += "\t";
			var _g = 0;
			var _g1 = o.length;
			while(_g < _g1) {
				var i = _g++;
				str += (i > 0 ? "," : "") + js_Boot.__string_rec(o[i],s);
			}
			str += "]";
			return str;
		}
		var tostr;
		try {
			tostr = o.toString;
		} catch( _g ) {
			return "???";
		}
		if(tostr != null && tostr != Object.toString && typeof(tostr) == "function") {
			var s2 = o.toString();
			if(s2 != "[object Object]") {
				return s2;
			}
		}
		var str = "{\n";
		s += "\t";
		var hasp = o.hasOwnProperty != null;
		var k = null;
		for( k in o ) {
		if(hasp && !o.hasOwnProperty(k)) {
			continue;
		}
		if(k == "prototype" || k == "__class__" || k == "__super__" || k == "__interfaces__" || k == "__properties__") {
			continue;
		}
		if(str.length != 2) {
			str += ", \n";
		}
		str += s + k + " : " + js_Boot.__string_rec(o[k],s);
		}
		s = s.substring(1);
		str += "\n" + s + "}";
		return str;
	case "string":
		return o;
	default:
		return String(o);
	}
};
function $getIterator(o) { if( o instanceof Array ) return new haxe_iterators_ArrayIterator(o); else return o.iterator(); }
String.__name__ = true;
Array.__name__ = true;
js_Boot.__toStr = ({ }).toString;
Form.renderers = [];
Main.main();
})({});
